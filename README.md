Zua
===

An attempt at a [Lua](https://lua.org) 5.1 implementation in [Zig](https://ziglang.org) v0.15.2 .

Goals, in order of priority:
1. Learn more about Lua internals
2. Learn more about Zig
3. Anything else

## Status

- [x] Lexer (llex.c/.h) -> [lex.zig](src/lex.zig)
  + [x] Keywords
  + [x] Identifiers
  + [x] `..`, `...`
  + [x] `==`, `>=`, `<=`, `~=`
  + [x] String literals (single/double quoted and multi-line (`[[`))
  + [x] Comments (`--` and `--[[`)
  + [x] Numbers
  + [x] Improve tests, perhaps use fuzz testing
    - See [Fuzzing As a Test Case Generator](https://www.ryanliptak.com/blog/fuzzing-as-test-case-generator/) and [naamfung/fuzzing-lua](https://github.com/naamfung/fuzzing-lua/)
  + [x] Cleanup implementation
- [x] String parsing (in Lua this was done at lex-time) -> [parse_literal.zig](src/parse_literal.zig) (see [`4324bd0`](https://github.com/naamfung/zua/commit/5de41fdf71eaf2a0b235e5eb581072d5488a1c57) for more details)
- [x] Number parsing (in Lua this was done at lex-time) -> [parse_literal.zig](src/parse_literal.zig)
  + [x] Basic number parsing
  + [x] Proper number parsing implementation
- [x] Parser (lparser.c/.h) (in Lua this was done as one step with no AST intermediate)
  + [x] Parsing tokens into an AST -> [parse.zig](src/parse.zig)
  + [x] Compiling the AST into bytecode -> [compiler.zig](src/compiler.zig)
- [x] Virtual Machine (lvm.c/.h) -> [vm.zig](src/vm.zig)
  + [x] Bytecode execution engine
  + [x] Stack operations
  + [x] Function calls
  + [x] Arithmetic operations
  + [x] Control flow (if/else, loops)
  + [x] Table operations
- [x] Object System (lobject.c/.h) -> [object.zig](src/object.zig)
  + [x] String objects
  + [x] Table objects
  + [x] Closure objects
  + [x] Upvalue objects
  + [x] Userdata objects
  + [x] Thread objects
- [x] Garbage Collector (lgc.c/.h) -> [gc.zig](src/gc.zig)
  + [x] Mark-sweep garbage collector
  + [x] GC state management
  + [x] Object marking
  + [x] Object sweeping
- [x] Standard Library (lbaselib.c, ltablib.c, lstrlib.c, lmathlib.c) -> [stdlib.zig](src/stdlib.zig)
  + [x] Base library (print, type, tostring, tonumber, etc.)
  + [x] Table library (insert, remove, concat, sort, etc.)
  + [x] String library (len, sub, lower, upper, etc.)
  + [x] Math library (abs, floor, ceil, sqrt, etc.)
- [x] REPL (lua.c) -> [zua.zig](src/zua.zig)
  + [x] Interactive command-line interface
  + [x] Execute Lua code from files
  + [x] Execute Lua code from command-line arguments

## Building / running

- `zig build` to build zua.exe
- `zig build test` to build & run the main test suite
- `zig build run` to build & run zua.exe (starts REPL)
- `zig build lua51_tests` to run tests on the PUC Lua 5.1 test files
- `zig build fuzzed_lex` to run lexer tests on a large set of inputs/outputs generated by [fuzzing-lua](https://github.com/naamfung/fuzzing-lua)
- `zig build bench_lex` to run a benchmark of the lexer

## Why Lua 5.1?

It's what I'm most familiar with, and I'm also assuming that 5.1 is simpler internally than more recent Lua versions.

## Building / running

- `zig build` to build zua.exe
- `zig build test` to build & run the main test suite
- `zig build run` to build & run zua.exe (does nothing right now)
- `zig build lua51_tests` to run tests on the PUC Lua 5.1 test files (currently it just tests parsing them)
- `zig build fuzzed_lex` to run lexer tests on a large set of inputs/outputs generated by [fuzzing-lua](https://github.com/naamfung/fuzzing-lua)
- `zig build bench_lex` to run a benchmark of the lexer (this benchmark needs improvement)
- `zig build fuzzed_strings` to run string parsing tests on a set of inputs/outputs generated by [fuzzing-lua](https://github.com/naamfung/fuzzing-lua)
